<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table-top Stat Tracker</title>
    <link rel="stylesheet" href="hostView_stylesheet2.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="dice-dropdown.js" defer></script> <!-- Here's the linked .js file you can use! only has dice stuff -->
    <script src="node_modules/dice-roller-parser/dist/index.js"></script>

</head>
<body>
    <header class="header">
        <img src="dndLogo.png" alt="DnD Logo" class="logo-icon"> 
        <div class="dice-section"> 
            <div class="dropdown" data-dropdown> <!-- dice roller dropdown -->
                <button class="dice-button" data-dropdown-button>Dice Roller</button>
                <div class="dropdown-menu">
                    <h1>Select Dice:</h1>
                    <div class="dice-icons">
                        <!-- Dice d4 -->
                        <div class="dice-type" data-dice="4">
                            <span class="dice-number">4</span> <!-- Add the dice type number here -->
                            <img src="d4.png" alt="d4">
                            <div class="quantity-control">
                                <button class="decrement">-</button>
                                <span class="quantity" data-quantity>0</span>
                                <button class="increment">+</button>
                            </div>
                        </div>
                        <!-- Dice d6 -->
                        <div class="dice-type" data-dice="6">
                            <span class="dice-number">6</span> <!-- Add the dice type number here -->
                            <img src="d6.png" alt="d6">
                            <div class="quantity-control">
                                <button class="decrement">-</button>
                                <span class="quantity" data-quantity>0</span>
                                <button class="increment">+</button>
                            </div>
                        </div>
                        <!-- Dice d8 -->
                        <div class="dice-type" data-dice="8">
                            <span class="dice-number">8</span> <!-- Add the dice type number here -->
                            <img src="d8.png" alt="d8">
                            <div class="quantity-control">
                                <button class="decrement">-</button>
                                <span class="quantity" data-quantity>0</span>
                                <button class="increment">+</button>
                            </div>
                        </div>
                        <!-- Dice d10 -->
                        <div class="dice-type" data-dice="10">
                            <span class="dice-number">10</span> <!-- Add the dice type number here -->
                            <img src="d10.png" alt="d10">
                            <div class="quantity-control">
                                <button class="decrement">-</button>
                                <span class="quantity" data-quantity>0</span>
                                <button class="increment">+</button>
                            </div>
                        </div>
                        <!-- Dice d12 -->
                        <div class="dice-type" data-dice="12">
                            <span class="dice-number">12</span> <!-- Add the dice type number here -->
                            <img src="d12.png" alt="d12">
                            <div class="quantity-control">
                                <button class="decrement">-</button>
                                <span class="quantity" data-quantity>0</span>
                                <button class="increment">+</button>
                            </div>
                        </div>     
                        <!-- Dice d20 -->
                        <div class="dice-type" data-dice="20">
                            <span class="dice-number">20</span> <!-- Add the dice type number here -->
                            <img src="d20.png" alt="d20">
                            <div class="quantity-control">
                                <button class="decrement">-</button>
                                <span class="quantity" data-quantity>0</span>
                                <button class="increment">+</button>
                            </div>
                        </div>    
                    </div>   
                    <h5>Or enter dice manually:</h5>                           
                    <div class="dropdown-input"> <!-- dice roller user input -->
                        <input type="text" id="dice-input" name="dice-input" placeholder="ex. 4d20">
                    </div>                 
                <button class="roll-button">Roll</button>
                <h4 id="roll-result"></h4> <!-- Display roll results here -->
            </div>
        </div>
    </header>

       
    <div class="search-container">
        <input type="text" class="search-box" placeholder="Enter player names, separated by commas">
        <button id="backward-btn">Backward</button>
        <button id="forward-btn">Forward</button>
    </div>
    
    
    
    <div class="container">
        <div class="fade-in-text">
            <p>Retro Roller</p>
        </div>
        
        <h2 class="fade-in-text">Virtual Table-Top Stat Tracker</h2>
        <button id="add-player">Add Player</button>
        <div id="players-container"></div>
    </div>
    
    <div class="enemy-container">
        <h3>Enemy List</h3>
        <input type="text" id="enemy-name-input" placeholder="Enter enemy name">
        <button id="add-enemy">Add Enemy</button>
        <ul id="enemy-list"></ul>
    </div>


    <script>
        const addEnemyBtn = document.getElementById('add-enemy');
        const enemyList = document.getElementById('enemy-list');

        addEnemyBtn.addEventListener('click', function() {
        const enemyNameInput = document.getElementById('enemy-name-input');
        const enemyName = enemyNameInput.value.trim();

        if (enemyName) {
            const listItem = document.createElement('li');
            listItem.textContent = enemyName;

            // Create delete button
            const deleteButton = document.createElement('button');
            deleteButton.textContent = "Delete";
            deleteButton.classList.add('delete-button');

            // Add event listener to remove the enemy name on delete button click
            deleteButton.addEventListener('click', function() {
                listItem.remove();
            });

            listItem.appendChild(deleteButton); 
            enemyList.appendChild(listItem);   
            enemyNameInput.value = '';         
        }
    });
    </script>


    <!-- Popup for icon selection -->
    <div id="icon-popup" class="icon-popup">
        <h3>Select Player Icon</h3>
        <div class="icon-selection">
            <img src="player_base.png" alt="Player Icon 1" class="icon-option">
            <img src="player_wizard.png" alt="Player Icon 2" class="icon-option">
            <img src="player_knight.png" alt="Player Icon 3" class="icon-option">
            <img src="player_boy.png" alt="Player Icon 4" class="icon-option">
            <img src="player_girl.png" alt="Player Icon 5" class="icon-option">
            <img src="player_elf.png" alt="Player Icon 6" class="icon-option">
            <img src="player_hood.png" alt="Player Icon 7" class="icon-option">
            <img src="player_wings.png" alt="Player Icon 8" class="icon-option">
            <!-- Add more icons as needed -->
        </div>
        <button id="close-popup">Close</button>
    </div>

    <script>
        const playerContainer = document.getElementById('players-container');
        const addPlayerBtn = document.getElementById('add-player');
        const forwardBtn = document.getElementById('forward-btn');
        const backwardBtn = document.getElementById('backward-btn');
        const searchBox = document.querySelector('.search-box');
        const iconPopup = document.getElementById('icon-popup');
        const rollResult = document.getElementById('roll-result'); // Element to display roll result
        let currentPlayerIcon = null; // Track the player icon currently being updated

        let players = [];
        let currentPlayerIndex = -1;

        document.addEventListener("DOMContentLoaded", () => {
            const incrementButtons = document.querySelectorAll(".increment");
            const decrementButtons = document.querySelectorAll(".decrement");
            const rollButton = document.querySelector(".roll-button");
            const resultDisplay = document.getElementById("roll-result");

            // Add event listeners for increment and decrement buttons
            incrementButtons.forEach(button => {
                button.addEventListener("click", () => {
                    const quantitySpan = button.parentElement.querySelector("[data-quantity]");
                    let quantity = parseInt(quantitySpan.textContent);
                    quantitySpan.textContent = quantity + 1;
                });
            });

            decrementButtons.forEach(button => {
                button.addEventListener("click", () => {
                    const quantitySpan = button.parentElement.querySelector("[data-quantity]");
                    let quantity = parseInt(quantitySpan.textContent);
                    if (quantity > 0) {
                        quantitySpan.textContent = quantity - 1;
                    }
                });
            });

        // Roll button click event
        rollButton.addEventListener("click", () => {
            
            const diceQuantities = {};
            const manualInput = document.getElementById("dice-input").value;

            // Collect quantities for each type of die
            document.querySelectorAll(".dice-type").forEach(dice => {
                const diceValue = dice.getAttribute("data-dice");
                const quantity = parseInt(dice.querySelector("[data-quantity]").textContent);
                if (quantity > 0) {
                    diceQuantities[diceValue] = quantity; // Store quantity for the corresponding die type
                }
            });

        // Select all dice images
        const diceImages = document.querySelectorAll(".dice-type img");

        // Function to start rolling animation
        function startRollingAnimation() {
            diceImages.forEach(img => img.classList.add("rolling"));
        }

                // Function to stop rolling animation
        function stopRollingAnimation() {
            diceImages.forEach(img => img.classList.remove("rolling"));
        }

        // Roll button click event
        rollButton.addEventListener("click", () => {
        startRollingAnimation();  // Start the rolling animation

        setTimeout(() => {
        // Stop the animation after 1 second (or any duration you prefer)
        stopRollingAnimation();

        // Existing dice roll logic
        const diceQuantities = {};
        const manualInput = document.getElementById("dice-input").value;

        // Collect quantities for each type of die
        document.querySelectorAll(".dice-type").forEach(dice => {
            const diceValue = dice.getAttribute("data-dice");
            const quantity = parseInt(dice.querySelector("[data-quantity]").textContent);
            if (quantity > 0) {
                diceQuantities[diceValue] = quantity; // Store quantity for the corresponding die type
            }
        });

        // Validation check: Either quantities or manual input must be provided, but not both
        if (Object.keys(diceQuantities).length > 0 && manualInput) {
            rollResult.textContent = "Please use either the dice selection or manual input, not both.";
            return; // Exit the function if both are provided
        }

        // Call the rollDice function with the collected quantities and manual input
        if(manualInput) rollDice(manualInput);
        else if(Object.keys(diceQuantities).length > 0) rollDice(diceQuantities);
        else rollResult.textContent = "No dice selected or input provided.";
    }, 1000); // Adjust duration as needed
    });




            // Validation check: Either quantities or manual input must be provided, but not both
            if (Object.keys(diceQuantities).length > 0 && manualInput) {
                rollResult.textContent = "Please use either the dice selection or manual input, not both.";
                return; // Exit the function if both are provided
            }

            // Call the rollDice function with the collected quantities and manual input
            if(manualInput) rollDice(manualInput);
            else if(Object.keys(diceQuantities).length > 0) rollDice(diceQuantities);
            else rollResult.textContent = "No dice selected or input provided.";
        });
    });
        // Function to handle dice rolling
        function rollDice(input) {
            if (typeof input == "string") {
                const regex = /^(\d+)d(\d+)$/;
                const match = input.match(regex);
                if (match) {
                    const numDice = parseInt(match[1]);
                    const diceType = parseInt(match[2]);
                    let total = 0;
                    const results = [];
                    for (let i = 0; i < numDice; i++) {
                        const roll = Math.floor(Math.random() * diceType) + 1;
                        results.push(roll);
                        total += roll;
                    }
                     rollResult.textContent = `Total: ${total}\nRolls:\n${results.join(', ')}`;
                } else {
                    rollResult.textContent = 'Invalid input! Please use format like 4d20.';
                }
            }
            else if (typeof input == "object") {
                let total = 0;
                const allResults = [];
                for (const [diceType, quantity] of Object.entries(input)) {
                    const diceResults = [];
                    for (let i = 0; i < quantity; i++) {
                        const roll = Math.floor(Math.random() * parseInt(diceType)) + 1;
                        diceResults.push(roll);
                        total += roll;
                    }
                    allResults.push(`${quantity}d${diceType}: [${diceResults.join(', ')}]`);
                }
                
                rollResult.textContent = `Total: ${total}\nRolls:\n${allResults.join('\n')}`;
            }
            else {
                rollResult.textContent = 'Unable to process roll. Try again. #ofDice\'d\'TypeOfDice';
            }
        }

        // Forward and backward navigation logic for highlighting players
        function highlightPlayer(playerName) {
            const allPlayerDivs = document.querySelectorAll('.player');
            allPlayerDivs.forEach(playerDiv => {
                const nameField = playerDiv.querySelector('.player-name');
                if (nameField.value.toLowerCase() === playerName.toLowerCase()) {
                    playerDiv.classList.add('glow');
                } else {
                    playerDiv.classList.remove('glow');
                }
            });
        }

        forwardBtn.addEventListener('click', function() {
            const playerNames = searchBox.value.split(',').map(name => name.trim());
            if (playerNames.length > 0) {
                currentPlayerIndex = (currentPlayerIndex + 1) % playerNames.length;
                highlightPlayer(playerNames[currentPlayerIndex]);
            }
        });

        backwardBtn.addEventListener('click', function() {
            const playerNames = searchBox.value.split(',').map(name => name.trim());
            if (playerNames.length > 0) {
                currentPlayerIndex = (currentPlayerIndex - 1 + playerNames.length) % playerNames.length;
                highlightPlayer(playerNames[currentPlayerIndex]);
            }
        });

        // Function to open the icon popup
        function openIconPopup(playerIcon) {
            currentPlayerIcon = playerIcon;
            iconPopup.style.display = 'block';
        }

        // Event listener for icon selection
        const iconOptions = document.querySelectorAll('.icon-option');
        iconOptions.forEach(icon => {
            icon.addEventListener('click', function() {
                if (currentPlayerIcon) {
                    currentPlayerIcon.src = this.src; // Update the player's icon
                }
                iconPopup.style.display = 'none'; // Close the popup
            });
        });

        // Function to add a new player
        addPlayerBtn.addEventListener('click', function() {
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player';

            playerDiv.innerHTML = `
                <img src="player_icon.png" alt="Player Icon" class="player-icon" style="filter: hue-rotate(${Math.floor(Math.random() * 570)}deg)">
                <input type="text" placeholder="Player Name" class="player-name">
                <h3 class="attributes-h3">Attributes</h3>
                <div class="stat-container attributes-container"></div>
                <button class="add-attribute">Add Attribute</button>

                <!-- Inventory section -->
                <h3>Inventory</h3>
                <div class="stat-container inventory-container"></div>
                <button class="add-item">Add Inventory</button>

                <button class="remove-player">Remove Player</button>
                <!-- Button to log player data -->
                <button class="submit-player" type="button">Update Player Data</button>
            `;

            playerContainer.appendChild(playerDiv);

            // Make the player icon clickable
            const playerIcon = playerDiv.querySelector('.player-icon');
            playerIcon.addEventListener('click', function() {
                openIconPopup(playerIcon); // Open the popup for this specific player's icon
            });

            // Handle attribute addition
            const addAttributeBtn = playerDiv.querySelector('.add-attribute');
            const attributesContainer = playerDiv.querySelector('.attributes-container');
            addAttributeBtn.addEventListener('click', function() {
                const newAttribute = document.createElement('div');
                newAttribute.className = 'stat-container';
                newAttribute.innerHTML = `
                    <label class="attribute">
                        <button class="remove-attribute-x">X</button>
                        <input type="text" class="attribute-name" placeholder="Attribute Name">
                        <button class="stat-button decrement">-</button>
                        <input type="number" class="stat-input" value="0">
                        <button class="stat-button increment">+</button>
                    </label>
                `;
                const statInput = newAttribute.querySelector('.stat-input');
                newAttribute.querySelector('.increment').addEventListener('click', function() {
                    statInput.value = parseInt(statInput.value) + 1;
                });
                newAttribute.querySelector('.decrement').addEventListener('click', function() {
                    statInput.value = parseInt(statInput.value) - 1;
                });
                newAttribute.querySelector('.remove-attribute-x').addEventListener('click', function() {
                    newAttribute.remove();
                });

                attributesContainer.appendChild(newAttribute);
            });

            // Handle inventory addition (similar to attributes)
            const addItemBtn = playerDiv.querySelector('.add-item');
            const inventoryContainer = playerDiv.querySelector('.inventory-container');
            addItemBtn.addEventListener('click', function() {
                const newItem = document.createElement('div');
                newItem.className = 'stat-container';
                newItem.innerHTML = `
                    <label class="item">
                        <button class="remove-item-x">X</button>
                        <input type="text" class="item-name" placeholder="Item Name">
                        <button class="stat-button decrement">-</button>
                        <input type="number" class="stat-input" value="0">
                        <button class="stat-button increment">+</button>
                    </label>
                `;
                const itemInput = newItem.querySelector('.stat-input');
                newItem.querySelector('.increment').addEventListener('click', function() {
                    itemInput.value = parseInt(itemInput.value) + 1;
                });
                newItem.querySelector('.decrement').addEventListener('click', function() {
                    itemInput.value = parseInt(itemInput.value) - 1;
                });
                newItem.querySelector('.remove-item-x').addEventListener('click', function() {
                    newItem.remove();
                });

                inventoryContainer.appendChild(newItem);
            });

            // Handle player removal
            const removePlayerBtn = playerDiv.querySelector('.remove-player');
            removePlayerBtn.addEventListener('click', function() {
                playerDiv.remove();
            });


// Update player data functionality
const submitPlayerBtn = playerDiv.querySelector('.submit-player');
submitPlayerBtn.addEventListener('click', function() {
    const playerName = playerDiv.querySelector('.player-name').value;
    const attributes = [...attributesContainer.querySelectorAll('.attribute')].map(attr => ({
        name: attr.querySelector('.attribute-name').value,
        value: attr.querySelector('.stat-input').value
    }));
    
    // Use '.item' class for inventory items
    const inventory = [...inventoryContainer.querySelectorAll('.item')].map(item => ({
        name: item.querySelector('.item-name').value,
        value: item.querySelector('.stat-input').value

    }));

    // Log player data to the console
    console.log({
        playerName,
        attributes,
        inventory
    });
});

        });

        // Close the icon popup
        document.getElementById('close-popup').addEventListener('click', function() {
            iconPopup.style.display = 'none';
        });
    </script>
</body>
</html>
